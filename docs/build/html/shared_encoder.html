

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Shared Encoder &mdash; multi-task-NLP 0.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="How to define your multi-task model?" href="define_multi_task_model.html" />
    <link rel="prev" title="Data transformations" href="data_transformations.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> multi-task-NLP
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="task_formats.html">Task Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_transformations.html">Data transformations</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Shared Encoder</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#what-is-a-shared-encoder">What is a shared encoder?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#task-specific-headers">Task specific headers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#choice-of-shared-encoder">Choice of shared encoder</a></li>
<li class="toctree-l2"><a class="reference internal" href="#losses">Losses</a></li>
<li class="toctree-l2"><a class="reference internal" href="#metrics">Metrics</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="define_multi_task_model.html">How to define your multi-task model?</a></li>
<li class="toctree-l1"><a class="reference internal" href="training.html">How to train?</a></li>
<li class="toctree-l1"><a class="reference internal" href="infering.html">How to Infer?</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">multi-task-NLP</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Shared Encoder</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/shared_encoder.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="shared-encoder">
<h1>Shared Encoder<a class="headerlink" href="#shared-encoder" title="Permalink to this headline">¶</a></h1>
<div class="section" id="what-is-a-shared-encoder">
<h2>What is a shared encoder?<a class="headerlink" href="#what-is-a-shared-encoder" title="Permalink to this headline">¶</a></h2>
<p>The concept of this library is to provide a single model for multiple tasks.
To achieve this we place a transformer-based encoder at centre. Data for all tasks will go through this centre encoder.
This encoder is called shared as it is responsible for majority of learnings on all the tasks.
Further, task specific headers are formed over the shared encoder.</p>
</div>
<div class="section" id="task-specific-headers">
<h2>Task specific headers<a class="headerlink" href="#task-specific-headers" title="Permalink to this headline">¶</a></h2>
<p>The encoder hidden states are consumed by task specific layers defined to output logits in the format required by the task.
Forward pass for a data batch belonging to say taskA occurs through the shared encoder and header for taskA.
The computed loss (which is called as ‘task loss’) is back-propagated through the same path.</p>
</div>
<div class="section" id="choice-of-shared-encoder">
<h2>Choice of shared encoder<a class="headerlink" href="#choice-of-shared-encoder" title="Permalink to this headline">¶</a></h2>
<p>We support multiple transformer-based encoder models.
For ease of use, we’ve integrated the encoders from the <a class="reference external" href="https://github.com/huggingface/transformers">transformers</a> library.
Available encoders with their config names are mentioned below.</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="38%" />
<col width="38%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Model type</th>
<th class="head">Config name</th>
<th class="head">Default config</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td rowspan="2">DISTILBERT</td>
<td>distilbert-base-uncased</td>
<td rowspan="2">distilbert-base-uncased</td>
</tr>
<tr class="row-odd"><td>distilbert-base-cased</td>
</tr>
<tr class="row-even"><td rowspan="4">BERT</td>
<td>bert-base-uncased</td>
<td rowspan="4">bert-base-uncased</td>
</tr>
<tr class="row-odd"><td>bert-base-cased</td>
</tr>
<tr class="row-even"><td>bert-large-uncased</td>
</tr>
<tr class="row-odd"><td>bert-large-cased</td>
</tr>
<tr class="row-even"><td rowspan="2">ROBERTA</td>
<td>roberta-base</td>
<td rowspan="2">roberta-base</td>
</tr>
<tr class="row-odd"><td>roberta-large</td>
</tr>
<tr class="row-even"><td rowspan="8">ALBERT</td>
<td>albert-base-v1</td>
<td rowspan="8">albert-base-v1</td>
</tr>
<tr class="row-odd"><td>albert-large-v1</td>
</tr>
<tr class="row-even"><td>albert-xlarge-v1</td>
</tr>
<tr class="row-odd"><td>albert-xxlarge-v1</td>
</tr>
<tr class="row-even"><td>albert-base-v2</td>
</tr>
<tr class="row-odd"><td>albert-large-v2</td>
</tr>
<tr class="row-even"><td>albert-xlarge-v2</td>
</tr>
<tr class="row-odd"><td>albert-xxlarge-v2</td>
</tr>
<tr class="row-even"><td rowspan="2">XLNET</td>
<td>xlnet-base-cased</td>
<td rowspan="2">xlnet-base-cased</td>
</tr>
<tr class="row-odd"><td>xlnet-large-cased</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="losses">
<h2>Losses<a class="headerlink" href="#losses" title="Permalink to this headline">¶</a></h2>
<p>We support following two types of loss functions.</p>
<dl class="class">
<dt id="models.loss.CrossEntropyLoss">
<em class="property">class </em><code class="descclassname">models.loss.</code><code class="descname">CrossEntropyLoss</code><span class="sig-paren">(</span><em>alpha=1.0</em>, <em>name='Cross Entropy Loss'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/models/loss.html#CrossEntropyLoss"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#models.loss.CrossEntropyLoss" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="models.loss.CrossEntropyLoss.forward">
<code class="descname">forward</code><span class="sig-paren">(</span><em>inp</em>, <em>target</em>, <em>attnMasks=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/models/loss.html#CrossEntropyLoss.forward"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#models.loss.CrossEntropyLoss.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the standard cross entropy loss as defined in pytorch.
This loss should be used for single sentence or sentence pair classification tasks.</p>
<p>To use this loss for training, set <code class="docutils literal notranslate"><span class="pre">loss_type</span></code> : <strong>CrossEntropyLoss</strong> in task file</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="models.loss.NERLoss">
<em class="property">class </em><code class="descclassname">models.loss.</code><code class="descname">NERLoss</code><span class="sig-paren">(</span><em>alpha=1.0</em>, <em>name='Cross Entropy Loss'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/models/loss.html#NERLoss"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#models.loss.NERLoss" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="models.loss.NERLoss.forward">
<code class="descname">forward</code><span class="sig-paren">(</span><em>inp</em>, <em>target</em>, <em>attnMasks=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/models/loss.html#NERLoss.forward"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#models.loss.NERLoss.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>This loss is a modified version of cross entropy loss for NER/sequence labelling tasks.
This loss ignores extra ‘O’ values through attention masks.</p>
<p>To use this loss for training, set <code class="docutils literal notranslate"><span class="pre">loss_type</span></code> : <strong>NERLoss</strong> in task file</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="metrics">
<h2>Metrics<a class="headerlink" href="#metrics" title="Permalink to this headline">¶</a></h2>
<p>For evaluating the performance on dev and test sets during training, we provide the following standard metrics.</p>
<span class="target" id="module-utils.eval_metrics"></span><p>File for creating metric functions</p>
<dl class="function">
<dt id="utils.eval_metrics.accuracy_">
<code class="descclassname">utils.eval_metrics.</code><code class="descname">accuracy_</code><span class="sig-paren">(</span><em>yTrue</em>, <em>yPred</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/utils/eval_metrics.html#accuracy_"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#utils.eval_metrics.accuracy_" title="Permalink to this definition">¶</a></dt>
<dd><p>Accuracy score for classification tasks using the label provided in file and predictions from multi-task model.
It takes a batch of predictions and labels.</p>
<p>To use this metric, add <strong>accuracy</strong> into list of <code class="docutils literal notranslate"><span class="pre">metrics</span></code> in task file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>yPred</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">list</span></code>) – [0, 2, 1, 3]</li>
<li><strong>yTrue</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">list</span></code>) – [0, 1, 2, 3]</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="utils.eval_metrics.f1_score_">
<code class="descclassname">utils.eval_metrics.</code><code class="descname">f1_score_</code><span class="sig-paren">(</span><em>yTrue</em>, <em>yPred</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/utils/eval_metrics.html#f1_score_"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#utils.eval_metrics.f1_score_" title="Permalink to this definition">¶</a></dt>
<dd><p>Standard f1 score from sklearn for classification tasks.
It takes a batch of predictions and labels.</p>
<p>To use this metric, add <strong>f1_score</strong> into list of <code class="docutils literal notranslate"><span class="pre">metrics</span></code> in task file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>yPred</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">list</span></code>) – [0, 2, 1, 3]</li>
<li><strong>yTrue</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">list</span></code>) – [0, 1, 2, 3]</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="utils.eval_metrics.seq_f1_score">
<code class="descclassname">utils.eval_metrics.</code><code class="descname">seq_f1_score</code><span class="sig-paren">(</span><em>yTrue</em>, <em>yPred</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/utils/eval_metrics.html#seq_f1_score"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#utils.eval_metrics.seq_f1_score" title="Permalink to this definition">¶</a></dt>
<dd><p>f1 score for NER/sequence labelling tasks taken from the <a class="reference external" href="https://github.com/chakki-works/seqeval">seqeval</a> library.</p>
<p>To use this metric, add <strong>seq_f1</strong> into list of <code class="docutils literal notranslate"><span class="pre">metrics</span></code> in task file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>y_true</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">list</span> <span class="pre">of</span> <span class="pre">list</span></code>) – [[‘O’, ‘O’, ‘O’, ‘B-MISC’, ‘I-MISC’, ‘I-MISC’, ‘O’], [‘B-PER’, ‘I-PER’, ‘O’]]</li>
<li><strong>y_pred</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">list</span> <span class="pre">of</span> <span class="pre">list</span></code>) – [[‘O’, ‘O’, ‘B-MISC’, ‘I-MISC’, ‘I-MISC’, ‘I-MISC’, ‘O’], [‘B-PER’, ‘I-PER’, ‘O’]]</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="utils.eval_metrics.seq_precision">
<code class="descclassname">utils.eval_metrics.</code><code class="descname">seq_precision</code><span class="sig-paren">(</span><em>yTrue</em>, <em>yPred</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/utils/eval_metrics.html#seq_precision"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#utils.eval_metrics.seq_precision" title="Permalink to this definition">¶</a></dt>
<dd><p>Precision score for NER/sequence labelling tasks taken from the <a class="reference external" href="https://github.com/chakki-works/seqeval">seqeval</a> library.</p>
<p>To use this metric, add <strong>seq_precision</strong> into list of <code class="docutils literal notranslate"><span class="pre">metrics</span></code> in task file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>y_true</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">list</span> <span class="pre">of</span> <span class="pre">list</span></code>) – [[‘O’, ‘O’, ‘O’, ‘B-MISC’, ‘I-MISC’, ‘I-MISC’, ‘O’], [‘B-PER’, ‘I-PER’, ‘O’]]</li>
<li><strong>y_pred</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">list</span> <span class="pre">of</span> <span class="pre">list</span></code>) – [[‘O’, ‘O’, ‘B-MISC’, ‘I-MISC’, ‘I-MISC’, ‘I-MISC’, ‘O’], [‘B-PER’, ‘I-PER’, ‘O’]]</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="utils.eval_metrics.seq_recall">
<code class="descclassname">utils.eval_metrics.</code><code class="descname">seq_recall</code><span class="sig-paren">(</span><em>yTrue</em>, <em>yPred</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/utils/eval_metrics.html#seq_recall"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#utils.eval_metrics.seq_recall" title="Permalink to this definition">¶</a></dt>
<dd><p>Recall score for NER/sequence labelling tasks taken from the <a class="reference external" href="https://github.com/chakki-works/seqeval">seqeval</a> library.</p>
<p>To use this metric, add <strong>seq_recall</strong> into list of <code class="docutils literal notranslate"><span class="pre">metrics</span></code> in task file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>y_true</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">list</span> <span class="pre">of</span> <span class="pre">list</span></code>) – [[‘O’, ‘O’, ‘O’, ‘B-MISC’, ‘I-MISC’, ‘I-MISC’, ‘O’], [‘B-PER’, ‘I-PER’, ‘O’]]</li>
<li><strong>y_pred</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">list</span> <span class="pre">of</span> <span class="pre">list</span></code>) – [[‘O’, ‘O’, ‘B-MISC’, ‘I-MISC’, ‘I-MISC’, ‘I-MISC’, ‘O’], [‘B-PER’, ‘I-PER’, ‘O’]]</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="define_multi_task_model.html" class="btn btn-neutral float-right" title="How to define your multi-task model?" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="data_transformations.html" class="btn btn-neutral float-left" title="Data transformations" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, saransh mehta

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>